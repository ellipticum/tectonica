# 05. Численная Архитектура Модели Тектоники

## 1. Представление состояния

Минимальный набор полей:

1. `plate_id` (int)
2. `plate_omega` (vec3 на плиту)
3. `boundary_type` (enum)
4. `boundary_width`
5. `strain_comp`, `strain_ext`, `strain_shear`
6. `ocean_age`
7. `crust_type` (`continental`/`oceanic`)
8. `crust_thickness`
9. `sediment_thickness`
10. `topography` / `bathymetry`

## 2. Пространственная схема

Для текущего стека оптимально:

1. Сферическая `equirectangular` решетка для рендера.
2. Топология плит и границ хранится отдельно (граф + полигоны на сфере).
3. Все переносы по поверхности выполняются через сферическую индексацию (`index_spherical`).

## 3. Временная схема

Шаг `dt` (обычно 0.1–1.0 Ma в offline-генерации):

1. Обновить `Ω_i`.
2. Адвектировать полигоны плит.
3. Пересчитать `boundary graph`.
4. Вычислить `v_n`, `v_t`.
5. Обновить деформационные поля.
6. Обновить `ocean_age`.
7. Посчитать высоты/глубины.
8. Выполнить осадочную релаксацию.

## 4. Численные методы

## 4.1 Адвекция полей

1. Semi-Lagrangian для устойчивости на больших `dt`.
2. TVD/limiter для уменьшения численного размазывания.

## 4.2 Геодезические расстояния

Для локальных метрик у границ использовать Dijkstra/Fast Marching с весами дуговой длины, не клеточный BFS.

## 4.3 Деформация и uplift

1. Строим поле `strain_rate`.
2. Конвертируем в `tectonic_uplift/subsidence` через режимные коэффициенты.
3. Применяем мягкую релаксацию (изостатический отклик) чтобы избежать «пилы».

## 4.4 Изостатическая релаксация

На уровне параметрической физики:

`dH/dt = (H_eq - H) / tau_iso`

где `H_eq` зависит от плотностей и толщин коры.

## 5. Производительность (Rust/WASM)

1. `preview` режим — меньше временных шагов, отключены тяжелые итерации.
2. `final` режим — полная временная эволюция.
3. Прогресс должен отражать фактические фазы (`plate solve`, `age advection`, `boundary solve`, `sediment solve`), а не таймер.

## 6. Ключевое инженерное правило

Каждый визуальный слой должен быть полностью воспроизводим из сохраненных физических полей.  
Если слой нельзя восстановить из состояния модели, значит это декоративный эффект, а не часть геофизики.

