# 04. Эрозия, Дренаж и Осадконакопление

## 1. Почему это ключ

Даже идеальная тектоника без нормальных поверхностных процессов дает "нарисованные" горы.  
Реалистичный рельеф рождается в балансе:

1. Поднятие (tectonic uplift),
2. Флювиальная эрозия,
3. Склоновые процессы,
4. Транспорт и отложение осадков.

## 2. Гидрологическое ядро

Пайплайн:

1. `slope` по DEM.
2. `flow_direction` (D8/D-infinity).
3. `flow_accumulation`.
4. Иерархия русел по порогу стока.
5. Бассейны и водоразделы.
6. Заполнение депрессий (priority flood), запрет циклов.

## 3. Флювиальная эрозия

Базовый закон:

`E_fluvial = K * A^m * S^n`

1. `A` — накопленный сток.
2. `S` — локальный уклон.
3. `K, m, n` зависят от литологии и климата.

Практика:

1. Более высокая эрозия на влажных и крутых склонах.
2. Ограничение сверху, чтобы не "ломать" DEM за шаг.

## 4. Склоновые процессы

Линейная/нелинейная диффузия:

`E_hillslope = D * laplacian(H)`  
или пороговая версия для крутых склонов.

Это сглаживает неестественные шипы, но без уничтожения реальных хребтов.

## 5. Осадочный бюджет

Каждая ячейка имеет `sediment_flux`.

1. Если транспортная способность > поступления: эрозия.
2. Если транспортная способность < поступления: осаждение.

Зоны доминирующего осаждения:

1. Предгорные бассейны.
2. Дельты.
3. Шельф и подножье континентального склона.

## 6. Временная схема

На каждом геологическом шаге:

1. Обновить `flow_direction/accumulation`.
2. Снять эрозию руслами.
3. Применить склоновую диффузию.
4. Перенести и отложить осадки.
5. Обновить высоту.

## 7. Ограничения для стабильности

1. CFL-подобное ограничение шага по времени.
2. Монотонность в руслах: вода не течет "вверх".
3. Никаких замкнутых циклов стока.
4. Ручное рисование рек запрещено.

## 8. Обязательные debug-слои

1. `flow_accumulation`
2. `channel_mask`
3. `erosion_rate`
4. `deposition_rate`
5. `sediment_flux`

Без этих слоев невозможно понять, почему рельеф получился таким.

