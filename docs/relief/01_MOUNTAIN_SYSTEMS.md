# 01. Горные Системы: Целевая Модель

## 1. Что сейчас не так

Текущий паттерн "горы как обводка плит" возникает, когда uplift почти напрямую привязан к локальной маске границы.  
Даже после сглаживания это остается геометрическим контуром, а не орогеном.

Основные симптомы:

1. Узкие длинные полосы с близкой толщиной.
2. Слишком резкие и регулярные оси хребтов.
3. Слабая региональная иерархия (нет крупного ядра + периферийных цепей).
4. Похожие формы в разных тектонических режимах.
5. Рельеф больше похож на пост-эффект, чем на результат деформации и эрозии.

## 2. Что считаем эталоном

Нужен рельеф, в котором:

1. Горные системы широкие и неоднородные, а не "линии".
2. Есть сегментация, ветвление, дуги, сдвиги, "ломаная" геометрия.
3. Есть иерархия:
   - макро-ороген (региональный пояс),
   - мезо-хребты,
   - локальные массивы и плоскогорья.
4. Разные режимы дают разные подписи:
   - коллизия континент-континент,
   - субдукционная дуга,
   - трансформная транспрессия,
   - рифтовые плечи.
5. После эрозии и переноса осадков форма остается правдоподобной.

## 3. Состояние, которое должно храниться

Минимальный набор полей на каждую ячейку:

1. `plate_id`
2. `crust_thickness_km`
3. `lithosphere_age_myr`
4. `strength` (эффективная прочность)
5. `heat_flux`
6. `inherited_weakness` (унаследованные слабые зоны)
7. `strain_comp` (сжатие)
8. `strain_shear` (сдвиг)
9. `uplift_rate`
10. `erosion_rate`
11. `sediment_flux`
12. `elevation_m`

## 4. Ключевая идея

Горы рождаются не на "линии границы", а в **поле распределенной деформации**, которое:

1. Вычисляется из кинематики соседних плит.
2. Расширяется на зону (а не 1-2 пикселя).
3. Усиливается или ослабляется реологией и наследованной структурой.
4. Интегрируется во времени.

## 5. Базовые уравнения (рабочая версия)

### 5.1 Декомпозиция относительной скорости

Для локальной пары плит:

1. `v_rel = v_b - v_a`
2. `v_n = dot(v_rel, n)` (нормальная компонента)
3. `v_t = dot(v_rel, t)` (тангенциальная компонента)

Где:

1. `n` — нормаль к локальной границе.
2. `t` — касательная к границе.

### 5.2 Локальные инварианты деформации

1. `strain_comp = max(v_n, 0)`  
   Только сближение работает на утолщение коры.
2. `strain_ext = max(-v_n, 0)`  
   Растяжение работает на рифт/утонение.
3. `strain_shear = abs(v_t)`  
   Для сдвиговых и транспрессионных структур.

### 5.3 Потенциал орогенеза

`P_oro = relu(a1*strain_comp + a2*strain_shear + a3*inherited_weakness + a4*heat_flux - a5*strength)`

Где коэффициенты `a1..a5` калибруются под Earth-like статистику.

### 5.4 Эволюция толщины коры

`dC/dt = k_thick*P_oro - k_ext*strain_ext - k_relax*max(C - C_eq, 0)`

1. `C` — толщина коры.
2. `C_eq` — равновесная толщина для данного термального режима.

### 5.5 Тектонический uplift

`U_tect = k_iso * log(1 + C/C0) * f_strength * f_climate`

1. `f_strength` снижает uplift в слабых горячих областях.
2. `f_climate` учитывает обратную связь с эрозией (не прямой климатический слой, а стабилизатор).

### 5.6 Полная динамика высоты

`dH/dt = U_tect - E_fluvial - E_hillslope + D_sediment`

## 6. Как получить "не-линейные" горные формы

### 6.1 Ширина зоны деформации должна быть переменной

`W_def = W0 * (1 + b1*weakness + b2*heat_flux - b3*strength + b4*obliquity)`

Именно переменная `W_def` убирает одинаковую толщину "полос".

### 6.2 Сегментация орогенов

Вводится поле сегментации `S_seg`:

1. От унаследованных рифтов/разломов.
2. От контрастов прочности.
3. От смены обстановки вдоль границы.

`P_oro_eff = P_oro * (0.6 + 0.8*S_seg)`

### 6.3 Транспрессия/транстенсия

При высоком `strain_shear` и умеренном `strain_comp` зона должна:

1. Вытягиваться,
2. Разбиваться на эшелоны,
3. Давать "ломаные", а не гладкие дуги.

### 6.4 Двухмасштабность uplift

Нужен не один слой uplift, а сумма:

1. `U_macro` от региональной деформации.
2. `U_meso` от локальных неоднородностей.
3. `U_micro` ограниченный, чтобы не портить макроформы.

## 7. Типы горных систем (обязательная дифференциация)

### 7.1 Континент-континент

1. Широкий ороген.
2. Плато/высокие внутренние области.
3. Foreland-бассейн на периферии.

### 7.2 Океан-континент (субдукция)

1. Узкая траншея + островная/континентальная дуга.
2. Выраженная асимметрия поперечного профиля.
3. Back-arc эффект в тылу дуги.

### 7.3 Океан-океан

1. Островные дуги цепочками.
2. Глубоководные желоба.
3. Неровная, но организованная дугообразность.

### 7.4 Трансформные зоны

1. Локальные uplift-пятна в транспрессии.
2. Линейные долины в транстенсии.
3. Отсутствие сплошного "горного шва".

## 8. Геологическое время: обязательно

Один проход по сетке недостаточен. Нужна эволюция:

1. `T = 120..300` условных шагов.
2. На каждом шаге:
   - обновить поля деформации,
   - обновить толщину коры,
   - обновить uplift,
   - выполнить эрозию/осадконакопление.

Горы становятся реалистичными, когда они "выживают" в конкуренции uplift и разрушения.

## 9. Минимальный псевдокод

```text
init_state(seed)
for t in 1..T:
  solve_plate_kinematics()
  compute_strain_fields()
  diffuse_strain_to_deformation_corridors()
  update_crust_thickness()
  compute_tectonic_uplift()
  run_hydrology()
  run_fluvial_erosion()
  run_hillslope_diffusion()
  route_and_deposit_sediment()
  update_elevation()
recenter_sea_level(target_ocean_fraction)
```

## 10. Контроль качества именно для гор

Критерии принятия:

1. Нет доминирующего класса "одинаковых линейных хребтов".
2. Есть диапазон ширин орогенов и сегментированность.
3. В поперечниках есть асимметрия там, где это ожидается тектонически.
4. Пики не строятся в равномерные "бусины" вдоль одной оси.
5. После 10+ сидов нет повторяющегося "одного шаблона гор".

## 11. Принцип внедрения

Сначала строим физическое ядро орогенеза, потом косметика.  
Любое сглаживание без физической причины запрещено как основной инструмент.

