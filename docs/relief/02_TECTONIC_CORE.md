# 02. Тектоническое Ядро (без "рисования границ")

## 1. Цель

Построить ядро, где границы плит являются входом в поле деформации, а не прямой маской рельефа.

## 2. Модель плит на сфере

### 2.1 Представление

1. Планета задается сферой.
2. Каждая ячейка хранит `plate_id`.
3. Плита хранит:
   - полюс вращения или 2D-проекцию скорости на сфере,
   - скорость,
   - термальный режим,
   - океаничность/континентальность.

### 2.2 Почему допускается Voronoi

Voronoi можно оставить для начальной сегментации плит, если:

1. На границе не происходит прямого "рисования uplift".
2. Есть широкий деформационный коридор.
3. Есть поле наследованных слабых зон, которое ломает геометрию.

## 3. Поля деформации

### 3.1 Расчет кинематики

Для каждой ячейки рядом с межплитной зоной:

1. Вычислить относительное движение соседних плит.
2. Получить `strain_comp`, `strain_ext`, `strain_shear`.
3. Учесть угол обликвити:
   - фронтальная коллизия,
   - косая коллизия,
   - почти чистый сдвиг.

### 3.2 Коридор деформации

Вместо линии вводится зона:

1. Стартовая ширина `W0`.
2. Модификаторы ширины:
   - прочность,
   - температура,
   - старые рифты,
   - тип границы.

3. Энергия деформации распределяется в пределах `W_def` с анизотропным затуханием.

## 4. Поле прочности и наследование структур

### 4.1 Прочность

`strength` строится из:

1. Возраста литосферы.
2. Теплового потока.
3. Типа коры (континент/океан).
4. Накопленной деформации.

### 4.2 Наследованные слабые зоны

`inherited_weakness` генерируется и эволюционирует:

1. Бывшие рифты остаются зонами предпочтительной ре-активации.
2. Старые швы коллизий могут ослаблять соседние участки.
3. Это обеспечивает "земную" сегментацию, а не идеальные полосы.

## 5. Эволюция коры

На шаге времени:

1. `crust_thickness += thickening - thinning - relaxation`
2. Где:
   - `thickening` от компрессии и транспрессии,
   - `thinning` от растяжения,
   - `relaxation` от гравитационного коллапса.

Это поле потом превращается в uplift через изостатику.

## 6. Выходы тектонического ядра

Обязательные карты:

1. `plate_id`
2. `boundary_regime` (conv/div/transform/mixed)
3. `strain_comp`
4. `strain_shear`
5. `crust_thickness`
6. `uplift_potential`

Дополнительные:

1. `strength`
2. `inherited_weakness`
3. `obliquity`

## 7. Как это встраивается в текущий код

Текущее место интеграции: `compute_relief` в `rust/planet_engine/src/lib.rs`.  
Нужно заменить схему "локальный boundary influence -> mountain_uplift" на pipeline:

1. `compute_tectonic_state()`
2. `update_crust_thickness_over_time()`
3. `compute_uplift_from_isostasy()`
4. `pass_to_surface_processes()`

## 8. Минимальная проверка корректности

1. Карта uplift не должна выглядеть как тонкие непрерывные линии.
2. Зоны компрессии должны быть шире и неровнее, чем зоны сдвига.
3. При одинаковом сиде результат должен быть детерминирован.
4. При разных сидах не должно быть повторения одного "штампа".

