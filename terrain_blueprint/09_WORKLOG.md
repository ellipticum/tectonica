# 09. Worklog

## Формат записи

Каждая запись:

1. Дата/время.
2. Этап из `06_IMPLEMENTATION_PLAN.md`.
3. Что изменено.
4. Метрики до/после.
5. Визуальный результат.
6. Следующий шаг.

## Записи

### 2026-02-22

1. Создана спецификация `terrain_blueprint/*`.
2. Зафиксирована целевая архитектура:
   - distributed deformation вместо boundary-stroke гор,
   - crust thickness + isostasy,
   - age-depth батиметрия,
   - erosion/sedimentation как обязательный слой,
   - объективные метрики Earth-like качества.
3. Следующий шаг: начать Этап 0 и Этап 1 из `06_IMPLEMENTATION_PLAN.md`.

### 2026-02-22 (реализация орогенеза, этап 0-1)

1. В `rust/planet_engine/src/lib.rs` полностью переработан блок `compute_relief`:
   - добавлены поля распределенной деформации `comp/ext/shear`,
   - добавлена диффузия деформации в широкие коридоры (вместо узкой линии границы),
   - добавлена эволюция толщины коры во времени (`crust` + `crust_eq`),
   - uplift теперь зависит от орогенного драйва и аномалии толщины коры,
   - океанический рельеф в базовой фазе учитывает divergent/convergent сигналы через новые поля.
2. Добавлен второй источник деформации:
   - из сглаженного поля скоростей плит (`velocity_x/velocity_y`) через градиенты дивергенции/сдвига,
   - смешивается с boundary-source и уменьшает эффект "рисованного шва".
3. Снижена зависимость от пост-обработки:
   - `defuse_orogenic_ribbons` применяется только в самом быстром режиме (`erosion_rounds == 0`).
4. Проверки сборки:
   - `bun run wasm:build` — OK,
   - `bun run build` — OK.
5. Контрольные прогоны (detailed):
   - `generations/runs/2026-02-22T22-55-15-317Z_seed-303001`,
   - `generations/runs/2026-02-22T22-55-43-151Z_seed-303002`,
   - `generations/runs/2026-02-22T22-56-11-782Z_seed-303003`.
6. Промежуточный вывод:
   - горный рельеф формируется через более широкие зоны деформации,
   - привязка высот к самой границе плит ослаблена,
   - нужно продолжить этап 2-4 (изостатика/батиметрия/эрозионно-осадочный цикл) для финального качества "как у Земли".

### 2026-02-22 (этап 1, дополнительная стабилизация)

1. Удален неиспользуемый `boundary_scores` из `ComputePlatesResult`.
2. Добавлено сглаженное поле скоростей плит (`velocity_x/velocity_y`) и градиентная деформация:
   - компрессия/экстензия/сдвиг из дивергенции и поперечных производных скорости.
3. Добавлен дополнительный "corridor smoothing" для `comp/ext/shear`, чтобы:
   - убрать гиперлокальные линейные полосы вдоль шва,
   - расширить орогенные зоны до региональных коридоров.
4. Добавлен скрипт оценки качества:
   - `scripts/evaluate-relief-quality.cjs`
   - команда `bun run gen:score`.
5. Контрольные прогоны на актуальном node wasm:
   - `generations/runs/2026-02-22T23-08-43-769Z_seed-616161`,
   - `generations/runs/2026-02-22T23-09-42-618Z_seed-616162`,
   - `generations/runs/2026-02-22T23-10-14-035Z_seed-616163`.
6. Зафиксированные метрики (`gen:score`):
   - `high90BoundaryShare` ~ `0.015..0.035`,
   - `high98BoundaryShare` ~ `0.034..0.074`.
