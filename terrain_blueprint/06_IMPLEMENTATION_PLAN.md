# 06. План Внедрения (Rust/WASM)

## 1. Принцип

Делаем поэтапно, чтобы каждый этап давал измеримый прирост качества и не ломал весь пайплайн.

## 2. Этап 0: Подготовка

1. Зафиксировать текущие baseline-метрики.
2. Добавить сохранение debug-слоев в генерацию.
3. Подготовить набор референс-сидов.

Готовность этапа:

1. Есть baseline-таблица.
2. Есть повторяемые прогоны.

## 3. Этап 1: Тектоническое поле деформации

1. Ввести `strain_comp/strain_shear/strain_ext`.
2. Ввести переменную ширину деформационного коридора.
3. Перевести uplift из "boundary stroke" в "distributed strain response".

Готовность этапа:

1. Хребты перестают быть узкими однотипными линиями.
2. Линейный штраф заметно падает.

## 4. Этап 2: Толщина коры и изостатика

1. Добавить `crust_thickness` и временную эволюцию.
2. Uplift считать через `crust_thickness`, а не напрямую от границы.
3. Добавить релаксацию (гравитационный коллапс).

Готовность этапа:

1. Появляется иерархия орогенов.
2. Пики и плато выглядят геологически связно.

## 5. Этап 3: Батиметрия на основе возраста коры

1. Ввести `ocean_age`.
2. Реализовать закон возраст-глубина.
3. Отдельно обработать active/passive margins и траншеи.

Готовность этапа:

1. Исчезает одинаковая прибрежная кромка.
2. Глубины океана разнообразны и физически читаемы.

## 6. Этап 4: Полноценная эрозия и осадки

1. Укрепить гидрологический пайплайн.
2. Добавить stream-power erosion.
3. Добавить осадочный бюджет.

Готовность этапа:

1. Формы гор становятся менее "пластиковыми".
2. Появляются правдоподобные передовые бассейны и дельты.

## 7. Этап 5: Калибровка и отбор

1. Подключить интегральный scoring.
2. Настроить пресеты поиска сидов.
3. Сравнить версии алгоритма статистически, не только визуально.

Готовность этапа:

1. Есть стабильный рост итогового score.
2. Сиды с высоким score визуально близки к референсам.

## 8. Этап 6: Полировка UI и инструменты отладки

1. Добавить просмотр промежуточных полей.
2. Добавить экспорт диагностических карт.
3. Добавить профили `fast/preview/final`.

Готовность этапа:

1. Дебаг возможен без ручного чтения внутренних буферов.
2. Падение FPS контролируемо.

## 9. Риски

1. Слишком тяжелая геофизика для real-time.
2. Переобучение метрик на один набор референсов.
3. Потеря детерминизма при параллелизации.

## 10. Как снижать риски

1. Разделить режимы preview/final по числу шагов времени.
2. Держать golden seeds и regression suite.
3. Фиксировать seeds и версии параметров в каждом прогоне.

